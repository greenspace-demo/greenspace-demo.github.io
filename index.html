<!doctype html>
<html>
	<head>
		<title>Green Space</title>
		<meta charset="utf-8"/>
		<meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
		<link rel="stylesheet" type="text/css" href="css/master.css">
		<link href="https://fonts.googleapis.com/css?family=Roboto+Slab" rel="stylesheet">
		<script src='https://api.mapbox.com/mapbox-gl-js/v0.51.0/mapbox-gl.js'></script>
		<link href='https://api.mapbox.com/mapbox-gl-js/v0.51.0/mapbox-gl.css' rel='stylesheet'/>
	</head>
	<body>
		<div class="box">
			<div class="row header">
				<p>Justinas Grigas</p>
			</div>
			<div class="row content" id="map"></div>
			<div class="row footer">
				<p>Green Space</p>
			</div>
		</div>

		<script>
			mapboxgl.accessToken = 'pk.eyJ1IjoianN0bi1hcyIsImEiOiJjam9samQ4bDkwOW9vM2txYnRnYmsyOXNxIn0.PHiPtQVUBhRqJQ0vIqSjaQ';

			function loadFile(filePath) {
				var result = null;
				var xmlhttp = new XMLHttpRequest();
				xmlhttp.open("GET", filePath, false);
				xmlhttp.send();
				if (xmlhttp.status==200) {
					result = xmlhttp.responseText;
				}
				return result;
			}

			var map = new mapboxgl.Map({
				container: 'map',
				style: 'mapbox://styles/mapbox/streets-v8',
				center: [0.0815423, 51.5394606],
				/*center: [-68.13734351262877, 45.137451890638886],*/
				zoom: 13
			});

			map.on('click', 'markers', function(e) {
				var coordinates = e.features[0].geometry.coordinates.slice();
				var stats = loadFile('https://raw.githubusercontent.com/jstn-as/Green-Spaces/master/json/stats.json')
				console.log(stats);
			})

			map.on('mouseenter', 'markers', function(e) {
				map.getCanvas().style.cursor = 'pointer';
			})

			map.on('mouseleave', 'markers', function(e) {
				map.getCanvas().style.cursor = '';
			})

			map.on('load', function () {
				map.addSource('markers', {
					type: 'geojson',
					data: 'https://raw.githubusercontent.com/jstn-as/Green-Spaces/master/geojson/markers.geojson'
				})

				map.addSource('outline', {
					type: 'geojson',
					data: 'https://raw.githubusercontent.com/jstn-as/Green-Spaces/master/geojson/BarkingOutline.geojson'
				})

				map.addLayer({
					'id': 'markers',
					'type': 'symbol',
					'source': 'markers',
					'layout': {
						'icon-image': "{icon}-15",
						'text-field': "{title}",
						'text-font': ["Open Sans Semibold"],
						'text-offset': [0, 0.6],
						'text-anchor': 'top'
					}
				})

				map.addLayer({
					'id': 'outline',
					'type': 'fill',
					'source': 'outline',
					'layout': {},
					'paint': {
						'fill-color': '#ff0000',
						'fill-opacity': 0.8
					}
				})
			});
		</script>
	</body>
</html>
